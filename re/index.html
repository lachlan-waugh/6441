<!doctype html><html lang=en><head><meta charset=utf-8><title>re</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1805>We&rsquo;ll get started at 18:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=reverse-engineering>Reverse Engineering</h1><h3 id=6841-week9>6841 week9</h3></section><section><h2 id=good-faith-policy>good faith policy</h2><p><del>We expect a high standard of professionalism from you at all times while you are taking any of our courses. We expect all students to act in good faith at all times</del></p><p><del><a href=https://sec.edu.au/good-faith-policy>sec.edu.au/good-faith-policy</a></del></p><blockquote><p>do this irl its really fun</p></blockquote></section><section><section data-shortcode-section><h3 id=whoami>whoami</h3><ul><li>lachlan/melon</li><li>security engineer @ google<ul><li>detection eng stuff</li></ul></li><li>teach <code>644[357]</code><ul><li>may meet some of you next year</li></ul></li></ul></section><section><h3 id=where-slides>where slides</h3><p>might be on webcms but I dont have access to that ll</p><blockquote><p><a href=https://waugh.zip/6441/re>waugh.zip/6441/re</a></p></blockquote></section><section><h3 id=shilling>shilling</h3><p>COMP6447 is cool</p><ul><li>DO COMP6447</li><li>DO COMP6447</li><li>DO COMP6447</li><li>DO COMP6447</li><li>DO COMP6447</li><li>DO COMP6447</li><li>DO COMP6447</li><li>DO COMP6447</li></ul><iframe width=560 style=position:absolute;height:600px!important;bottom:-25%;left:-25%;overflow:visible src="https://www.youtube.com/embed/i0M4ARe9v0Y?si=7PC6qY_KRjN1WJ2P&autoplay=1&mute=1&controls=0&modestbranding&showinfo=0" allow=autoplay title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy=strict-origin-when-cross-origin allowfullscreen></iframe>
<iframe width=560 style=position:absolute;height:600px!important;bottom:-25%;right:-25%;overflow:visible src="https://www.youtube.com/embed/NX-i0IWl3yg?si=E2318HUCu79n2SUt?si=00VYhWc7SS7iG0tA?si=7PC6qY_KRjN1WJ2P&autoplay=1&mute=1&controls=0&modestbranding&showinfo=0" allow=autoplay title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy=strict-origin-when-cross-origin allowfullscreen></iframe></section></section><section><section data-shortcode-section><h3 id=what-is-re>what is re?</h3><p><strong>reverse engineering</strong></p><ul><li><em>&ldquo;the process of discovering the technological principles of a device, object, or system through analysis of its structure, function, and operation&rdquo;</em></li><li>basically, <strong>finding out how something works</strong></li><li>we cover reverse engineering x86 binaries (& how to determine their original source code)</li></ul></section><section><h3 id=why-re>why re?</h3><ul><li>finding vulns (wargames?)</li><li>malware (<a href=https://bluecatnetworks.com/blog/dns-helped-stop-wannacry-ransomware-attack/>what it do</a>)</li><li>breaking drm/keygens (<a href="https://www.youtube.com/watch?v=cwyH59nACzQ">mod 7</a>)</li><li>understanding closed source software</li></ul><blockquote><p>all code is oss if you&rsquo;re good at re</p></blockquote></section></section><section><section data-shortcode-section><h3 id=short-aside>short aside</h3><p>before re, what about e?</p></section><section><h3 id=compilation>compilation</h3><p>how does your code become a binary?</p><img height=500 style=margin-top:0 src=../assets/img/re/compilation.svg></section><section><h3 id=compilation-is-lossy>compilation is lossy</h3><ul><li>compilers are really smart, and will <a href=https://en.wikipedia.org/wiki/Optimizing_compiler>optimize</a> your bad code into good code</li><li>so the output doesn&rsquo;t reflect the input 1:1</li><li>you&rsquo;ll lose context: variable names (not <strong>always</strong> symbols), comments, #DEFINEs</li></ul><blockquote><p>optimization is the devil</p></blockquote></section><section><h3 id=another-aside>another aside</h3><p>we&rsquo;re only talking about C binaries</p><ul><li>you can absolutely reverse other compiled languages: rust, golang, java, even pyc</li></ul><blockquote><p>they&rsquo;re usually just a lot more tedious</p></blockquote></section></section><section><section data-shortcode-section><h3 id=how2re>how2re</h3><p>surely theres an easier way to do this</p><p><img src=../assets/img/re/hexdump.png alt></p></section><section><h3 id=tooling>tooling</h3><p>very important to have tools that perform analysis</p><ul><li><em>static</em>: read the program without running it</li><li><em>dynamic</em>: show the state of the program as it runs</li></ul></section><section><h3 id=static-analysis>static analysis</h3><p><em>disassembling</em></p><ul><li>examine an executable without running it</li><li>what instruction do the bytes correspond to?</li></ul><blockquote><p>e.g. ida, ghidra, radare, binary ninja</p></blockquote></section><section><h3 id=dynamic-analysis>dynamic analysis</h3><p><em>debugging</em></p><ul><li>examine an executable by running it</li><li>what are the register values at X point in time</li><li>allows you to examine program state as it runs</li></ul><blockquote><p>e.g. <strong>gdb</strong>, ltrace, strace, windbg</p></blockquote></section><section><h3 id=another-aside>another aside??</h3><p>im an official:TM: default gdb hater</p><blockquote><p>if you&rsquo;re using gdb, install an extension e.g. <a href=https://github.com/pwndbg/pwndbg>pwndbg</a>, <a href=https://github.com/hugsy/gef>gef</a>, or <a href=https://github.com/longld/peda>peda</a></p></blockquote></section></section><section><section data-shortcode-section><h3 id=at-a-high-level>at a high level</h3><p>reversing is hard, and takes a lot of time</p><ul><li>don&rsquo;t focus on every single instruction, try to understand the big picture</li><li>its largely down to pattern recognition</li><li>functions are super helpful (if they aren&rsquo;t stripped)</li></ul></section><section><h3 id=what-does-this-do>what does this do?</h3><p><img src=../assets/img/re/wtf.png alt></p><blockquote><p>lol idk either</p></blockquote></section><section><h3 id=what-about-this-instead>what about this instead?</h3><p>time for a demo</p><img height=500 src=../assets/img/re/strcat.png></section><section><h3 id=dont-scroll-any-further>dont scroll any further</h3></section><section><h3 id=the-original-code>the original code</h3><p>how close were we?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>re3</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>s1, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>s2) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>size_t</span> a <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(s1);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>size_t</span> b <span style=color:#f92672>=</span> <span style=color:#a6e22e>strlen</span>(s2);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s1 <span style=color:#f92672>=</span> <span style=color:#a6e22e>realloc</span>(s1, (a <span style=color:#f92672>+</span> b <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>memcpy</span>(s1 <span style=color:#f92672>+</span> a, s2, b <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> s1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=a-bit-deeper>a bit deeper</h3><p>how does assembly work</p></section><section><h3 id=registers>registers</h3><img height=500 src=../assets/img/re/registers.png></section><section><h3 id=stack-frames>stack frames</h3><img height=500 src=../assets/img/re/frame.jpg></section><section><h3 id=calling-conventions>calling conventions</h3><p>x86 uses the <a href=https://en.wikipedia.org/wiki/X86_calling_conventions#cdecl>cdecl</a> calling convention</p><ul><li>parameters are passed on the stack</li><li>return value stored in eax</li><li>caller allocs args/eip, callee ebp/locals</li><li>callee also cleans up its args</li></ul><blockquote><p>its just convention, not guaranteed. not everything uses it</p></blockquote></section><section><h3 id=callee-cleans-up-args>callee cleans up args</h3><pre tabindex=0><code>function(x, y, z):
push z
push y
push x
call function
add esp, 0xC
</code></pre></section></section><section><section data-shortcode-section><h3 id=assembly>assembly</h3></section><section><h2 id=the-stack-grows-down>the stack grows down</h2><ul><li>the stack grows from high address to low addresses</li><li>so the top of the stack, is lower down in memory</li><li>ebp points to the base of the frame (higher in memory)</li><li>esp points to the top of the frame (lower in memory)</li></ul></section><section><h2 id=stack-frames>stack frames</h2><p>basic example</p><pre tabindex=0><code>    0x30  [   ARGS   ] &lt;- parameters
    0x28  [    EIP   ] &lt;- stored return pointer
    0x20  [    EBP   ] &lt;- stored frame pointer
    0x18  [ AAAAAAAA ] &lt;- local vars
    0x10  [ 00000000 ] &lt;- an int?
    0x08  [ DEADBEEF ] &lt;- a pointer
    0x00  [ 59454554 ] &lt;- 4 characters
</code></pre></section><section><h2 id=variables>variables</h2><p>referenced in relation to <code>ebp</code> e.g. <code>ebp-0x4</code></p><ul><li>local vars are <del>above</del> lower, so <code>ebp-0x4</code></li><li>arguments are <del>below</del> higher so <code>ebp+0x8</code></li></ul></section><section><h3 id=what-are-the-variables-used-for>what are the variables used for</h3><p>instructions give context to the variables they act on</p><p><img src=../assets/img/re/operation_implications.png alt></p></section><section><h3 id=a-question-for-you>a question for you</h3><p>why are these instructions different?</p><pre tabindex=0><code>mov eax, dword ptr [esp]
mov eax, word ptr [esp]
mov eax, byte ptr [esp]
mov ax, [esp]
mov al, [esp]
</code></pre></section></section><section><section data-shortcode-section><h3 id=control>control</h3></section><section><h3 id=instructions>instructions</h3><ul><li>jmp/call</li><li>push/pop</li><li>add/sub</li><li>mov/lea</li><li>and/xor</li><li>test/cmp</li></ul></section><section><h3 id=mov>mov</h3><p>stands for <strong>mov</strong>e</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>eax</span>, <span style=color:#a6e22e>ebx</span>        <span style=color:#75715e># eax = ebx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>eax</span>, [<span style=color:#a6e22e>ebx</span>]      <span style=color:#75715e># eax = *ebx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>eax</span>, [<span style=color:#a6e22e>ebx</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>4</span>]  <span style=color:#75715e># eax = *(ebx + 4)
</span></span></span></code></pre></div><blockquote><p>what might that last one represent?</p></blockquote></section><section><h3 id=lea>lea</h3><p>stands for <strong>l</strong>oad <strong>e</strong>ffective <strong>a</strong>ddress</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>lea</span> <span style=color:#a6e22e>eax</span>, [<span style=color:#a6e22e>ebx</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># equivalent to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>mov</span> <span style=color:#a6e22e>eax</span>, <span style=color:#a6e22e>ebx</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>add</span> <span style=color:#a6e22e>eax</span>, <span style=color:#ae81ff>8</span>
</span></span></code></pre></div><p>often used for fast addition/multiplication</p><pre tabindex=0><code>lea eax, [ebx * 4 + 8]
</code></pre></section><section><h3 id=cmp--test>cmp & test</h3><p>the two main comparison instructions</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>TEST</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>a</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>b</span><span style=color:#f92672>&gt;</span>    <span style=color:#75715e># a &amp; b
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>CMP</span>  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>a</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>b</span><span style=color:#f92672>&gt;</span>    <span style=color:#75715e># a - b
</span></span></span></code></pre></div><blockquote><p>Sets zero/negative/positive flags in EFLAGS</p></blockquote></section><section><h3 id=jumping>jumping</h3><p>now we&rsquo;ve done a comparison, we can (maybe) jump</p><ul><li>theres a lot of types of jumps<ul><li>jz: jump if zero flag set</li><li>jnz: jump if zero flag not set</li><li>jge (>=): positive || zero flag is set</li><li>jlt (&lt;): negative flag set</li></ul></li></ul><blockquote><p>some will be signed comparisons, some not</p></blockquote></section></section><section><section data-shortcode-section><h3 id=deobfuscation>deobfuscation</h3><p><em>degarbage</em></p></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>print_nums</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>nums</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nums</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>e</span>) =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Hello </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>e</span><span style=color:#e6db74>}</span><span style=color:#e6db74>!`</span>));
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>print_nums</span>([<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>7</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>9</span>, <span style=color:#ae81ff>10</span>]);
</span></span></code></pre></div></section><section><pre tabindex=0><code>(function(_0x20a892,_0x42c6a2){const _0x110cc6=_0x3fb9,_0x5e470a=_0x20a892();while(!![]){try{const _0x28667e=-parseInt(_0x110cc6(0xd6))/0x1+-parseInt(_0x110cc6(0xd5))/0x2+parseInt(_0x110cc6(0xd1))/0x3+parseInt(_0x110cc6(0xd3))/0x4+-parseInt(_0x110cc6(0xd2))/0x5+-parseInt(_0x110cc6(0xcf))/0x6+parseInt(_0x110cc6(0xce))/0x7;if(_0x28667e===_0x42c6a2)break;else _0x5e470a[&#39;push&#39;](_0x5e470a[&#39;shift&#39;]());}catch(_0x44da5f){_0x5e470a[&#39;push&#39;](_0x5e470a[&#39;shift&#39;]());}}}(_0x51e8,0x1d318));const _0x3701c2=_0x1e33b1=&gt;{const _0x312fdd=_0x3fb9;_0x1e33b1[_0x312fdd(0xd4)](_0xd313=&gt;console[&#39;log&#39;](_0x312fdd(0xd0)+_0xd313+&#39;!&#39;));};function _0x3fb9(_0x442c25,_0x161fd0){const _0x51e8ef=_0x51e8();return _0x3fb9=function(_0x3fb99b,_0x2e90f0){_0x3fb99b=_0x3fb99b-0xce;let _0x53b2c7=_0x51e8ef[_0x3fb99b];return _0x53b2c7;},_0x3fb9(_0x442c25,_0x161fd0);}function _0x51e8(){const _0x363b8b=[&#39;1406202HDigRG&#39;,&#39;486342oaFrmi&#39;,&#39;Hello\x20&#39;,&#39;679206PuoPaQ&#39;,&#39;614310PnzrDk&#39;,&#39;630464HDiLMH&#39;,&#39;forEach&#39;,&#39;257710HKLNTu&#39;,&#39;132554IxtBWS&#39;];_0x51e8=function(){return _0x363b8b;};return _0x51e8();}_0x3701c2([0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa]);
</code></pre></section></section><section><h2 id=questions>questions?</h2></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>