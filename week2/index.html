<!doctype html><html lang=en><head><meta charset=utf-8><title>02: sqli</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1805>We&rsquo;ll get started at 18:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=sqli>sqli</h1><h3 id=6841-week02>6841 week02</h3></section><section><section data-shortcode-section><h2 id=housekeeping>housekeeping</h2><p><img src=../assets/img/broom.gif alt></p></section><section><h3 id=class-notes>class notes</h3><p>our tutorial is scheduled to do the lecture notes for the wednesday lecture of week 4</p></section><section><h3 id=class-representatives>class representatives</h3><p>you get to attend meetings with Richard?</p><ul><li>have they mentioned this?</li><li>if you want to nominate yourself, cool</li><li>maybe we can vote as a class?</li></ul></section><section><h2 id=logbooks>logbooks</h2></section><section><h3 id=feedback-on-logbooks>feedback on logbooks</h3><ul><li>some didn&rsquo;t do the learning community/dealing with challenges sections.<ul><li>this is worth 40% of the mark per week, you should do it.</li></ul></li><li>if you&rsquo;re unsure how to approach the it, check out some other people&rsquo;s logbook</li></ul></section><section><h3 id=non-technical-questions>non-technical questions</h3><p>try to focus on analysis, rather than just noting down what you read</p><ul><li>what conclusions did you come to?</li><li>what made you come to them?</li><li>what did you learn?</li></ul></section><section><h3 id=technical-questions>technical questions</h3><ul><li>just showing you solved it (e.g flag) isn&rsquo;t enough</li><li>show me what you didn&rsquo;t work (and why not? or why YOU didn&rsquo;t think it worked)</li><li>show me the process you took to get the solution, not the solution!</li></ul></section><section><h3 id=what-do-i-want>what do I want</h3><p>do just this stuff</p><ul><li>case study analysis</li><li>extended challenge (e.g. SQLi, XSS)</li><li>50%* of the other challenges</li></ul><blockquote><p>* rounded up</p></blockquote></section><section><h2 id=something-awesome>something awesome</h2></section><section><h3 id=what-to-do-now>what to do now</h3><ul><li>plan it now, before you start working on it.</li><li>work on your marking criteria (pls).</li><li>post weekly update blogs!<ul><li>easier to determine how much time you put in</li><li>stops you from leaving it all until the last minute</li></ul></li></ul></section><section><h3 id=what-to-do-throughout-the-term>what to do throughout the term</h3><ul><li>you should spend around 30 hours total on it.</li><li>at the end of term, you present what you produced<ul><li>you record a video presentation (marked), and</li><li>present it during the tutorial (not marked)</li></ul></li></ul><blockquote><p>if it has something targeting others, you need their express permission</p></blockquote></section><section><h3 id=who-doesnt-love-presenting>who doesn&rsquo;t love presenting</h3><p>share what you&rsquo;re planning on doing for your Something Awesome!</p></section></section><section><section data-shortcode-section><h2 id=woops>woops</h2><p>some stuff I forgot to mention last week</p></section><section><h2 id=comp6441-vs-comp6841>COMP6441 vs COMP6841</h2><ul><li>extended isn&rsquo;t much more difficult, there&rsquo;s just &ldquo;different&rdquo; content.</li><li>different (better) weekly challenges, exam questions, and an extra lecture hour each week.</li><li>if you&rsquo;re technically-inclined, I&rsquo;d recommend 6841.</li><li>generally extended security courses are intended for people with an interest in pursuing security-adjacent careers</li></ul></section><section><h3 id=other-security-courses>other security courses</h3><p>ones i&rsquo;ve done, in order of goodness</p><ul><li>COMP6447</li><li>COMP6[84]43</li><li>MATH3411</li><li>COMP9447</li><li>COMP6[84]45</li></ul></section><section><h3 id=even-more>even more</h3><p>others I haven&rsquo;t done</p><ul><li>COMP9301</li><li>COMP6448</li><li>COMP4337</li></ul></section></section><section><section data-shortcode-section><h3 id=what-is-the-most-insecure-part-of>what is the most insecure part of</h3><ul><li>a system (e.g. a bank or banking app)?</li><li>password authentication (think outside the box)</li></ul></section><section><h3 id=what-is-the-cia-triad>what is the CIA triad?</h3><ul><li>CDont hack me pls</li><li>Idk</li><li>A</li></ul></section><section><h3 id=what-is-the-general-anatomy-of-an-attack>what is the general anatomy of an attack</h3><ol><li></li><li></li><li></li><li></li><li></li></ol></section><section><h3 id=what-is-security-by-design>what is security by design</h3><ul><li>what is shifting security left?</li><li>why is this important/beneficial</li><li>proactive good, reactive bad?</li></ul></section><section><h3 id=what-are-type-i-and-ii-errors>what are type I and II errors?</h3><p>this slide is intentionally blank</p></section></section><section><h1 id=questions>questions?</h1></section><section><section data-shortcode-section><h1 id=sql>SQL</h1><blockquote><p>structured query language</p></blockquote><ul><li>SQLite, PostgreSQL, MySQL, MSSQL Server</li></ul></section><section><p>Queries ></p><ul><li><code>SELECT &lt;column> FROM &lt;table>;</code></li><li><code>INSERT INTO table VALUES (a, b);</code></li><li><code>UPDATE table SET ... = ...</code></li><li><del><code>DELETE FROM table ...</code></del> (<em>pls dont</em>)</li><li><code>-- a comment (also #)</code></li></ul></section><section><p>SELECT * FROM table WHERE &mldr;</p><ul><li><code>col = ...</code></li><li><code>col > ...</code></li><li><code>col &lt; ...</code></li><li><code>col &lt;> ... #</code> not equals (!=)</li><li><code>col LIKE ... #</code> regexp<ul><li><code>_</code> <code>(.)</code> and <code>%</code> <code>(.*)</code> are wildcards</li></ul></li></ul></section><section><p><code>SELECT user, pass FROM users UNION SELECT title, author FROM blogs</code></p><pre tabindex=0><code>  user	  pass	     id	  title   author	THE UNION
|=======|=======|   |===|=======|=======|   |=======|=======|
| admin	| admin	|   | 1 | blog1 | melon |   | admin | admin |
| melon	| water	|   | 2 | blog2 | admin |   | melon | water |
|=======|=======|   | 3 | blog3 | admin |   | blog1 | melon |
		            |===|=======|=======|   | blog2 | admin |
		 		                      	    | blog3 | admin |
      users     		   blogs        	|=======|=======|
</code></pre></section><section><h2 id=notes-on-unions>Notes on UNIONs</h2><ul><li>the query needs to extract the same number of columns from both tables</li><li>the data-type for the columns must be compatible</li><li>you can also UNION the same table</li></ul></section><section><blockquote><p>fingerprinting</p></blockquote><ul><li>work out the flavour/version<ul><li><strong>MySQL</strong>: <code>Version()</code></li><li><strong>SQLite</strong>: <code>sqlite_version()</code></li><li><strong>MSSQL</strong>: <code>@@Version</code></li></ul></li></ul></section><section><blockquote><p>finding the schema</p></blockquote><ul><li>what tables exist, what do they look like?<ul><li><strong>MySQL</strong>: <code>information_schema.[tables|columns]</code></li><li><strong>SQLite</strong>: <code>sqlite_[master|schema]</code></li><li><strong>MSSQL</strong>: <code>SHOW TABLES; DESCRIBE &lt;table_name></code></li></ul></li></ul></section></section><section><h2 id=sqli-1>SQLi</h2><section data-shortcode-section><h3 id=sql-injection>SQL Injection</h3><ul><li><p><em>tldr</em>: blindly trusting user input is bad</p></li><li><p>what if we injected control characters which changed how the database interprets the query? e.g. inject our own <code>UNIONS/WHERES/etc</code></p></li><li><p>how could it tell the difference?</p></li></ul></section><section><h3 id=how-does-sqli-work>How does SQLi work</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{input}&#39;</span> <span style=color:#66d9ef>AND</span> password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;{...}&#39;</span>
</span></span></code></pre></div><p>Â </p><p>If our input was: <code>' OR 1=1 --</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>--                        vvvvvvvvvvvvvvvvvvvv
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>user</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span> <span style=color:#66d9ef>OR</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> <span style=color:#75715e>--&#39;and password = &#39;...&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>--                        ^^^^^^^^^^^^^^^^^^^^
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- user = &#39;&#39; is always false, but 1=1 is always true
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- so this will return every user from the database
</span></span></span></code></pre></div></section><section><h3 id=issues-you-may-encounter>issues you may encounter</h3><ul><li><p>syntax needs to be correct, or you&rsquo;ll throw an error</p><ul><li>so, determine syntax through errors/fingerprint</li></ul></li><li><p>you have SQLi in <code>items</code>, but want <code>users</code></p><ul><li>find out the tables? (database schema)</li><li>include that table with a <code>UNION</code></li></ul></li></ul></section></section><section><h1 id=demo>demo</h1><blockquote><p>a basic login form</p></blockquote></section><section><h2 id=mitigations>mitigations</h2><section data-shortcode-section><h3 id=defense>defense</h3><ul><li>reduce information disclosure<ul><li>don&rsquo;t display error messages</li><li>just fail or show a basic error message (e.g. <code>'username or password incorrect'</code>)</li></ul></li><li>strip out malicious content (e.g. use a WAF)</li><li>block requests with anything sus (<em>kinda bad UX</em>)</li></ul></section><section><h3 id=better-defence>better defence</h3><ul><li>don&rsquo;t use raw content<ul><li>use parameterised queries rather than raw input</li><li>use an ORM (database as an object)</li></ul></li></ul><blockquote><p>note: these have historically still been vulnerable, don&rsquo;t solely rely on them</p></blockquote></section><section><h3 id=offense>offense</h3><ul><li>content stripped?<ul><li>embed dummy characters (oORr)</li><li>use alternating case (WhErE)</li></ul></li><li>no response?<ul><li>timing Attacks (IF success THEN sleep(1))</li><li>error-based extraction (get the output in an error)</li><li>boolean-based extraction (IF success THEN &mldr;)</li></ul></li></ul></section></section><section><h1 id=questions-1>Questions</h1></section><section><h2 id=case-study>Case Study</h2><p><img src=../assets/img/week02/drill.gif alt></p></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>